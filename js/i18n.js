// ===== PlainFinance - Internationalization =====

const translations = {
    en: {
        // Navigation
        nav_home: 'Home',
        nav_how_it_works: 'How It Works',
        nav_pricing: 'Pricing',
        nav_login: 'Log In',
        nav_signup: 'Sign Up',
        nav_my_reports: 'My Reports',
        nav_new_analysis: 'New Analysis',
        nav_logout: 'Log Out',

        // Homepage
        hero_title: 'Your numbers. In plain English.',
        hero_subtitle: 'Upload your financial statements. Get a clear, jargon-free report that tells you exactly how your business is doing and what to do next.',
        hero_cta: 'Analyze My Numbers',
        hero_secondary: 'See a Sample Report',

        // How it works
        how_title: 'How it works',
        how_step1_title: 'Enter your numbers',
        how_step1_desc: 'Input your revenue, expenses, and cash position. Takes about 2 minutes.',
        how_step2_title: 'AI analyzes everything',
        how_step2_desc: 'Our AI compares your metrics to industry benchmarks and identifies what matters.',
        how_step3_title: 'Get your plain English report',
        how_step3_desc: 'Receive a clear report with specific actions. No accounting jargon.',

        // Analyze page
        analyze_title: 'Analyze Your Numbers',
        analyze_subtitle: 'Enter your financial data and get a plain English report',
        step_company: 'Company',
        step_sales: 'Sales & Profit',
        step_got: 'Got',
        step_owe: 'What You Owe',
        step_compare: 'Compare',
        company_name: 'Company Name',
        report_period: 'Report Period',
        currency: 'Currency',
        industry_type: 'Industry Type',
        revenue: 'Revenue (Sales)',
        cogs: 'Cost of Goods Sold',
        opex: 'Operating Expenses',
        net_profit: 'Net Profit',
        cash: 'Cash in Bank',
        receivables: 'Accounts Receivable',
        inventory: 'Inventory',
        payables: 'Accounts Payable',
        short_term_loans: 'Short-term Loans',
        other_liabilities: 'Other Current Liabilities',
        generate_report: 'Generate My Report',
        back: 'Back',
        next: 'Next',

        // Report page
        report_for: 'Financial Report for',
        download: 'Download',
        download_full: 'Full Report PDF',
        download_investor: 'Investor Summary (1 page)',
        whatsapp: 'WhatsApp',
        email_report: 'Email Report',
        new_analysis: 'New Analysis',
        key_numbers: '5 key numbers you need to know',
        cash_flow_title: 'How fast does cash move through your business?',
        cash_flow_subtitle: 'This explains why you might be profitable but short on cash',
        actions_title: 'What to do next',
        actions_subtitle: 'Specific actions based on your numbers',
        benchmark_title: 'How do you compare to your industry?',
        forecast_title: 'Your cash flow forecast',
        forecast_subtitle: 'Where your cash position is heading based on current patterns',
        vat_title: 'VAT Summary',
        vat_subtitle: 'Your VAT position for this period',
        summary_title: 'Summary for bank or investor meetings',
        summary_subtitle: 'Use this when someone asks "how is your business doing?"',

        // Alerts
        alerts_title: 'Set up WhatsApp alerts',
        alerts_subtitle: 'Get notified when key metrics cross your thresholds',
        alerts_configure: 'Configure your alerts',
        alerts_runway: 'Cash runway drops below',
        alerts_margin: 'Profit margin drops below',
        alerts_dso: 'Days to collect payment exceeds',
        alerts_cash: 'Cash balance drops below',
        alerts_save: 'Save Alert Settings',
        alerts_how_works: 'When you generate a new report and any metric crosses your threshold, you will see an alert with a WhatsApp button to notify yourself or your team immediately.',
        alerts_all_good: 'All metrics are within your thresholds. You are doing well.',
        alerts_weeks: 'weeks',
        alerts_days: 'days',

        // Common
        loading: 'Loading...',
        error: 'Error',
        success: 'Success',
        cancel: 'Cancel',
        save: 'Save',
        delete: 'Delete',
        view: 'View',
        send: 'Send'
    },
    ar: {
        // Navigation
        nav_home: 'الرئيسية',
        nav_how_it_works: 'كيف يعمل',
        nav_pricing: 'الأسعار',
        nav_login: 'تسجيل الدخول',
        nav_signup: 'إنشاء حساب',
        nav_my_reports: 'تقاريري',
        nav_new_analysis: 'تحليل جديد',
        nav_logout: 'تسجيل الخروج',

        // Homepage
        hero_title: 'أرقامك. بلغة واضحة.',
        hero_subtitle: 'قم بإدخال بياناتك المالية. احصل على تقرير واضح بدون مصطلحات محاسبية معقدة يخبرك بالضبط كيف يسير عملك وماذا تفعل بعد ذلك.',
        hero_cta: 'حلل أرقامي',
        hero_secondary: 'شاهد نموذج تقرير',

        // How it works
        how_title: 'كيف يعمل',
        how_step1_title: 'أدخل أرقامك',
        how_step1_desc: 'أدخل إيراداتك ومصروفاتك ووضعك النقدي. يستغرق حوالي دقيقتين.',
        how_step2_title: 'الذكاء الاصطناعي يحلل كل شيء',
        how_step2_desc: 'يقارن الذكاء الاصطناعي مقاييسك بمعايير الصناعة ويحدد ما يهم.',
        how_step3_title: 'احصل على تقريرك بلغة واضحة',
        how_step3_desc: 'استلم تقريراً واضحاً مع إجراءات محددة. بدون مصطلحات محاسبية.',

        // Analyze page
        analyze_title: 'حلل أرقامك',
        analyze_subtitle: 'أدخل بياناتك المالية واحصل على تقرير بلغة واضحة',
        step_company: 'الشركة',
        step_sales: 'المبيعات والأرباح',
        step_got: 'ما لديك',
        step_owe: 'ما عليك',
        step_compare: 'المقارنة',
        company_name: 'اسم الشركة',
        report_period: 'فترة التقرير',
        currency: 'العملة',
        industry_type: 'نوع الصناعة',
        revenue: 'الإيرادات (المبيعات)',
        cogs: 'تكلفة البضاعة المباعة',
        opex: 'المصروفات التشغيلية',
        net_profit: 'صافي الربح',
        cash: 'النقد في البنك',
        receivables: 'الذمم المدينة',
        inventory: 'المخزون',
        payables: 'الذمم الدائنة',
        short_term_loans: 'القروض قصيرة الأجل',
        other_liabilities: 'الالتزامات المتداولة الأخرى',
        generate_report: 'أنشئ تقريري',
        back: 'رجوع',
        next: 'التالي',

        // Report page
        report_for: 'التقرير المالي لـ',
        download: 'تحميل',
        download_full: 'التقرير الكامل PDF',
        download_investor: 'ملخص للمستثمرين (صفحة واحدة)',
        whatsapp: 'واتساب',
        email_report: 'إرسال بالبريد',
        new_analysis: 'تحليل جديد',
        key_numbers: '٥ أرقام رئيسية تحتاج معرفتها',
        cash_flow_title: 'ما سرعة تدفق النقد في عملك؟',
        cash_flow_subtitle: 'هذا يفسر لماذا قد تكون مربحاً لكن تعاني من نقص النقد',
        actions_title: 'ماذا تفعل بعد ذلك',
        actions_subtitle: 'إجراءات محددة بناءً على أرقامك',
        benchmark_title: 'كيف تقارن بصناعتك؟',
        forecast_title: 'توقعات التدفق النقدي',
        forecast_subtitle: 'إلى أين يتجه وضعك النقدي بناءً على الأنماط الحالية',
        vat_title: 'ملخص ضريبة القيمة المضافة',
        vat_subtitle: 'وضعك الضريبي لهذه الفترة',
        summary_title: 'ملخص لاجتماعات البنوك أو المستثمرين',
        summary_subtitle: 'استخدم هذا عندما يسألك أحد "كيف يسير عملك؟"',

        // Alerts
        alerts_title: 'إعداد تنبيهات واتساب',
        alerts_subtitle: 'احصل على إشعار عندما تتجاوز المقاييس الرئيسية حدودك',
        alerts_configure: 'إعداد التنبيهات',
        alerts_runway: 'رصيد النقد يقل عن',
        alerts_margin: 'هامش الربح يقل عن',
        alerts_dso: 'أيام التحصيل تتجاوز',
        alerts_cash: 'رصيد النقد يقل عن',
        alerts_save: 'حفظ إعدادات التنبيهات',
        alerts_how_works: 'عند إنشاء تقرير جديد وتجاوز أي مقياس للحد المحدد، سترى تنبيهاً مع زر واتساب لإشعار نفسك أو فريقك فوراً.',
        alerts_all_good: 'جميع المقاييس ضمن الحدود المحددة. أنت تسير بشكل جيد.',
        alerts_weeks: 'أسابيع',
        alerts_days: 'أيام',

        // Common
        loading: 'جاري التحميل...',
        error: 'خطأ',
        success: 'نجاح',
        cancel: 'إلغاء',
        save: 'حفظ',
        delete: 'حذف',
        view: 'عرض',
        send: 'إرسال'
    }
};

// Get current language from localStorage or default to English
function getCurrentLang() {
    return localStorage.getItem('plainfinance_lang') || 'en';
}

// Set language
function setLang(lang) {
    localStorage.setItem('plainfinance_lang', lang);
    applyLanguage(lang);
}

// Get translation
function t(key) {
    const lang = getCurrentLang();
    return translations[lang]?.[key] || translations['en']?.[key] || key;
}

// Apply language to page
function applyLanguage(lang) {
    const html = document.documentElement;

    // Set direction and language
    if (lang === 'ar') {
        html.setAttribute('dir', 'rtl');
        html.setAttribute('lang', 'ar');
        document.body.classList.add('rtl');
    } else {
        html.setAttribute('dir', 'ltr');
        html.setAttribute('lang', 'en');
        document.body.classList.remove('rtl');
    }

    // Update all elements with data-i18n attribute
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        el.textContent = t(key);
    });

    // Update placeholders
    document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.getAttribute('data-i18n-placeholder');
        el.placeholder = t(key);
    });

    // Update language tabs - highlight active tab
    document.querySelectorAll('.lang-tab').forEach(tab => {
        const tabLang = tab.getAttribute('data-lang');
        if (tabLang === lang) {
            tab.classList.add('active');
        } else {
            tab.classList.remove('active');
        }
    });

    // Legacy: Update old single button switcher if exists
    const langBtn = document.getElementById('langSwitcher');
    if (langBtn) {
        langBtn.textContent = lang === 'ar' ? 'EN' : 'عربي';
    }
}

// Toggle language
function toggleLanguage() {
    const current = getCurrentLang();
    const newLang = current === 'en' ? 'ar' : 'en';
    setLang(newLang);

    // Reload page to apply all translations
    window.location.reload();
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', () => {
    applyLanguage(getCurrentLang());
});
